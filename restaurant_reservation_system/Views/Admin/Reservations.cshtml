@using restaurant_reservation.Models
@using restaurant_reservation_system.Models.Dto
@using restaurant_reservation_system.Models.ViewModel
@{
    ViewData["Title"] = "Reservations"; 
}

@model AdminReservationsViewModel

<div class="container mt-4">
    <h2 class="text-center mb-4">User And Guest Reservations</h2>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        @{
            int i = 1;
        }
        @foreach (var userReservation in Model.UserReservations)
        {
            <div class="col">
                <div class="card h-100">
                    <div class="card-header bg-primary text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            @if (userReservation.Status == ReservationStatus.Confirmed.ToString())
                            {
                                <span class="badge bg-success">@userReservation.Status</span>
                            }
                            else if (userReservation.Status == ReservationStatus.Pending.ToString())
                            {
                                <span class="badge bg-warning">@userReservation.Status</span>
                            }
                            else if (userReservation.Status == ReservationStatus.Outdated.ToString())
                            {
                                <span class="badge bg-danger">@userReservation.Status</span>
                            }
                        </div>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">User Reservation #@i</h5>

                        <div class="mb-3">
                            <span class="ms-2">@userReservation.CustomerName</span>
                        </div>
                        <div class="mb-3">
                            <span class="ms-2">@userReservation.CustomerEmail</span>
                        </div>
                        <div class="mb-3">
                            <span class="ms-2">@userReservation.CustomerPhone</span>
                        </div>

                        <div class="mb-3">
                            <span class="ms-2">@userReservation.ReservationDateLocal.ToShortDateString()</span>
                        </div>
                        <div class="mb-3">
                            <span class="ms-2">@userReservation.ReservationHour:00</span>
                        </div>
                        <div class="mb-3">
                            <span class="ms-2">@userReservation.NumberOfGuests guests</span>
                        </div>
                        <div class="text-muted small">
                            <span class="ms-2">Created: @userReservation.CreatedAtLocal.ToShortDateString() @userReservation.CreatedAtLocal.ToShortTimeString()</span>
                        </div>

                        <br />
                        <form asp-controller="Admin" asp-action="DeleteUserReservation" method="post" style="display: inline;" id="deleteForm_@userReservation.Id">
                            <input type="hidden" name="id" value="@userReservation.Id" />
                            <button type="button" class="btn-outline-primary btn-sm" onclick="showDeleteModal(@userReservation.Id)">Delete</button>
                        </form>

                        @if (userReservation.Status == "Pending")
                        {
                            <form asp-controller="Admin" asp-action="UpdateUserReservationStatus" method="post" style="display: inline;" id="confirmForm_@userReservation.Id">
                                <input type="hidden" name="id" value="@userReservation.Id" />
                                <input type="hidden" name="status" value="Confirmed" />
                                <button type="button" class="btn-outline-primary btn-sm" onclick="showConfirmModal(@userReservation.Id)">Confirm Reservation</button>
                            </form>
                        }
                        else if (userReservation.Status == "Confirmed")
                        {
                            <form asp-controller="Admin" asp-action="UpdateUserReservationStatus" method="post" style="display: inline;" id="cancelForm_@userReservation.Id">
                                <input type="hidden" name="id" value="@userReservation.Id" />
                                <input type="hidden" name="status" value="Pending" />
                                <button type="button" class="btn-outline-primary btn-sm" onclick="showCancelConfirmationModal(@userReservation.Id)">Cancel Confirmation</button>
                            </form>
                        }
                    </div>
                </div>
            </div>

            i++;
        }
        @{
            i = 1;
        }
        @foreach (var guestReservation in Model.GuestReservations)
        {
            <div class="col">
                <div class="card h-100">
                    <div class="card-header bg-black text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            @if (guestReservation.Status == ReservationStatus.Confirmed.ToString())
                            {
                                <span class="badge bg-success">@guestReservation.Status</span>
                            }
                            else if (guestReservation.Status == ReservationStatus.Pending.ToString())
                            {
                                <span class="badge bg-warning">@guestReservation.Status</span>
                            }
                            else if (guestReservation.Status == ReservationStatus.Outdated.ToString())
                            {
                                <span class="badge bg-danger">@guestReservation.Status</span>
                            }
                        </div>
                    </div>
                    <div class="card-body" @(string.Equals(guestReservation.Status, "Outdated") ? "bg-secondary" : "bg-white")>
                        <h5 class="card-title">Guest Reservation #@i</h5>

                        <div class="mb-3">
                            <span class="ms-2">@guestReservation.FullName</span>
                        </div>
                        <div class="mb-3">
                            <span class="ms-2">@guestReservation.Email</span>
                        </div>
                        <div class="mb-3">
                            <span class="ms-2">@guestReservation.PhoneNumber</span>
                        </div>

                        <div class="mb-3">
                            <span class="ms-2">@guestReservation.ReservationDateLocal.ToShortDateString()</span>
                        </div>
                        <div class="mb-3">
                            <span class="ms-2">@guestReservation.ReservationDateLocal.ToShortTimeString()</span>
                        </div>
                        <div class="mb-3">
                            <span class="ms-2">@guestReservation.NumberOfGuests guests</span>
                        </div>
                        <div class="text-muted small">
                            <span class="ms-2">Created: @guestReservation.CreatedAtLocal.ToShortDateString() @guestReservation.CreatedAtLocal.ToShortTimeString()</span>
                        </div>

                        <br />
                        <form asp-controller="Admin" asp-action="DeleteGuestReservation" method="post" style="display: inline;" id = "deleteForm_@guestReservation.Id">
                            <input type="hidden" name="id" value="@guestReservation.Id" />
                            <button type="button" class="btn-outline-primary btn-sm" onclick="showDeleteModal(@guestReservation.Id)">Delete</button>
                        </form>

                        @if (guestReservation.Status == "Pending")
                        {
                            <form asp-controller="Admin" asp-action="UpdateGuestReservationStatus" method="post" style="display: inline;" id="confirmForm_@guestReservation.Id">
                                <input type="hidden" name="id" value="@guestReservation.Id" />
                                <input type="hidden" name="status" value="Confirmed" />
                                <button type="button" class="btn-outline-primary btn-sm" onclick="showConfirmModal(@guestReservation.Id)">Confirm Reservation</button>
                            </form>
                        }
                        else if (guestReservation.Status == "Confirmed")
                        {
                            <form asp-controller="Admin" asp-action="UpdateGuestReservationStatus" method="post" style="display: inline;" id="cancelForm_@guestReservation.Id">
                                <input type="hidden" name="id" value="@guestReservation.Id" />
                                <input type="hidden" name="status" value="Pending" />
                                <button type="button" class="btn-outline-primary btn-sm" onclick="showCancelConfirmationModal(@guestReservation.Id)">Cancel Confirmation</button>
                            </form>
                        }
                    </div>
                </div>
            </div>

            i++;
        }
    </div>

    <partial name="_DeleteConfirmationModal" />

</div>

@section Scripts {
    <script>
        function showDeleteModal(reservationId) {
            const modal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
            document.getElementById('confirmDeleteBtn').onclick = function () {
                document.getElementById(`deleteForm_${reservationId}`).submit();
            };
            modal.show();
        }

        function showConfirmModal(reservationId) {
            const modal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
            document.getElementById('confirmDeleteBtn').onclick = function () {
                document.getElementById(`confirmForm_${reservationId}`).submit();
            };
            modal.show();
        }

        function showCancelConfirmationModal(reservationId) {
            const modal = new bootstrap.Modal(document.getElementById('deleteConfirmationModal'));
            document.getElementById('confirmDeleteBtn').onclick = function () {
                document.getElementById(`cancelForm_${reservationId}`).submit();
            };
            modal.show();
        }
    </script>
}


<style>
    .card {
        transition: transform 0.2s;
        cursor: pointer;
    }

    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
</style>